{% extends "base.html" %}
{% block content %}

<div class="">
<h1> {{ summonerName }}'s latest match </h1>
</div>
<div class="row">
  <div class="col-md-2">
      <h1 class={% if match.win %}"text-success"{% else %}"text-danger"{% endif %}> {% if match.win %} Victory {% else %} Defeat {% endif %}  </h1> 
      {{ match.date.strftime('%Y-%m-%d at %H:%M') }}
      </br>
      </br>
    <div class="panel panel-info">
      <ul class="list-group">
        <!-- <a href="#" class="list-group-item active"> -->
	<!--   {{ summonerName }}          -->
        <!-- </a> -->
        <a class="list-group-item">
          <span class="badge">    {{ player["champion"] }} </span>
          Champion
        </a>
        <a class="list-group-item">
          <span class="badge">    {{ player["kills"] }} </span>
          Kills
        </a>
        <a class="list-group-item">
          <span class="badge">    {{ player["deaths"] }} </span>
          Deaths
        </a>
        <a class="list-group-item">
          <span class="badge">    {{ player["assists"] }} </span>
          Assists
        </a>
        <a class="list-group-item">
          <span class="badge">    {{ player["minionsKilled"] }} </span>
          Minions
        </a>
        <a class="list-group-item">
          <span class="badge">    {{ player["goldEarned"] }} </span>
          Gold
        </a>
      </ul>
    </div>
  </div>
  <div class="col-md-10" id="plot">

  </div>
</div>
<script>
// TODO: Move all the styling to CSS
// TODO: Add events by adding circles on top of the line
// TODO: Add interactivity to show events by mousehover

var margin = {
    top: 20,
    right: 10,
    bottom: 20,
    left: 40
};
var width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;


var svg_outer = d3.select("#plot").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom);

var svg = svg_outer.append("g")
.attr("transform", "translate(" + margin.left + "," + margin.top + ")")
    .attr("class", "winprob");



// TODO: change max to max of data time

var max_timestamp = 60;
var xScale = d3.scale.linear()
    .domain([0, max_timestamp])
    .range([0, width]);

var yScale = d3.scale.linear()
    .domain([0, 1])
    .range([height, 0]);


var formatAsPercentage = d3.format(".0%");
var winprob_line = {{ match.get_winprob_dataframe() | safe }}

var lines = svg.selectAll("line")
    .data(winprob_line)
    .enter()
    .append("line");

var lineAttributes = lines.attr("x1", function (d) {
    return xScale(d.timestamp - 1);
})
    .attr("x2", function (d) {
    return xScale(d.timestamp);
})
    .attr("y1", function (d) {
    return yScale(d.winprob_before);
})
    .attr("y2", function (d) {
    return yScale(d.winprob_now);
})
    .style("stroke", "rgb(218,165,32)")
    .style("stroke-width", "4");

//Create the Axis
var xAxis = d3.svg.axis().scale(xScale).orient("bottom").ticks(5);
var xAxisGroup = svg.append("g")
    .attr("class", "axis")
    .attr("transform", "translate(0," + height + ")")
    .call(xAxis);


var yPadding = 0;
var n_y_ticks = 3;
var yAxis = d3.svg.axis().scale(yScale).orient("left").ticks(n_y_ticks).tickFormat(formatAsPercentage);


var yAxisGroup = svg.append("g")
    .attr("class", "axis")
    .attr("transform", "translate(" + yPadding + ",0)")
    .attr("stroke-width", "1px")
    .call(yAxis);


svg.selectAll("line.horizontalGrid").data(yScale.ticks(2)).enter()
    .append("line")
    .attr({
    "class": "horizontalGrid",
        "x1": 0,
        "x2": width,
        "y1": function (d) {
        return yScale(d);
    },
        "y2": function (d) {
        return yScale(d);
    },
        "fill": "none",
        "shape-rendering": "crispEdges",
        "stroke": "black",
        "stroke-width": "1px",
        "stroke-dasharray": "2, 2"
});

svg.selectAll("line.vertcialGrid").data(xScale.ticks(5)).enter()
    .append("line")
    .attr({
    "class": "verticalGrid",
        "y1": 0,
        "y2": height,
        "x1": function (d) {
        return xScale(d);
    },
        "x2": function (d) {
        return xScale(d);
    },
        "fill": "none",
        "shape-rendering": "crispEdges",
        "stroke": "black",
        "stroke-width": "1px",
        "stroke-dasharray": "2, 2"
});

</script>

{% endblock %}

